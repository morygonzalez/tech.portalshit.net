<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>たのしいネットストーキング with Ruby |  tech.portalshit.net -  CakePHP, Rails, JavaScript</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link href="/stylesheets/1.css" rel="stylesheet" type="text/css" />
<link href="/stylesheets/red.css" rel="stylesheet" type="text/css" />
<link href="/feed/atom.xml" rel="alternate" type="application/atom+xml" />
</head>
<body>

		<div id="header">
		
				<h1><a href="/">tech.portalshit.net</a></h1>

				<h3>CakePHP, Rails, JavaScript</h3>
				
				<ul id="nav">
					<li><a href="/">Home</a></li>
					
				</ul>
		</div>
		<div id="container">
			<div id="content">
				<h2>たのしいネットストーキング with Ruby</h2>
				<p>この前大阪で第二回アメ村ブルゾンの会をやったんですけど、そこで日夜<del>ネットストーキング</del>プログラミングにいそしんでおられる皆さんとお会いして、TwitterのStreaming APIの使い方を教えてもらいました。なんか自分でやろうとしてたんだけど、全然見当違いなところを見ていたみたいで、僕もStreaming APIでネットストーキングできるようになりました。pokutunaさんにもらったコードと &#8220;Twitter Streaming APIをRubyで試してみる - しばそんノート&#8221;:http://d.hatena.ne.jp/shibason/20090816/1250405491 を参考に、以下のような感じにしてみました。</p>
<pre class='markdown-html-error' style='border: solid 3px red; background-color: pink'>REXML could not parse this XML/HTML: 
&lt;pre&gt;&lt;code&gt;
#!/usr/bin/env ruby
# coding: utf-8

require &apos;net/http&apos;
require &apos;uri&apos;
require &apos;rubygems&apos;
require &apos;json&apos;

USERNAME = &apos;morygonzalez&apos;
PASSWORD = &apos;***&apos;

uri = URI.parse(&apos;http://chirpstream.twitter.com/2b/user.json&apos;)
begin
  Net::HTTP.start(uri.host, uri.port) do |http|
    request = Net::HTTP::Get.new(uri.request_uri)
    request.basic_auth(USERNAME, PASSWORD)
    http.request(request) do |response|
      raise &apos;Response is not chunked&apos; unless response.chunked?
      response.read_body do |chunk|
        #空行は無視
        status = JSON.parse(chunk) rescue next
        #eventを含まないものは無視
        next unless status[&apos;event&apos;]
        source = status[&apos;source&apos;]
        if status[&apos;target_object&apos;]
          target_obj = status[&apos;target_object&apos;]
          target_user = target_obj[&apos;user&apos;]
          puts &quot;#{status[&apos;event&apos;]}: #{source[&apos;screen_name&apos;]} -&gt; #{target_user[&apos;screen_name&apos;]}: #{target_obj[&apos;text&apos;]}&quot;
        elsif status[&apos;target&apos;]
          target = status[&apos;target&apos;]
          puts &quot;#{status[&apos;event&apos;]}: #{source[&apos;screen_name&apos;]} -&gt; #{target[&apos;screen_name&apos;]}&quot;
        end
      end
    end
  end

rescue Timeout::Error =&gt; ex
  p &quot;&lt;-----!!!! Timeout::Error!!!!-----&gt;&quot;
  
  retry
end
&lt;/code&gt;&lt;/pre&gt;</pre>
<p>教えてもらったコードではTweetの内容を垂れ流しにするやつだったんですけど、自分でちょこっといじってTweet以外のステータスを表示するようにしてみた。しかしなんか調子悪いっぽくて、完全にはStreamを取れてないっぽいです。</p>

<p>でもまぁ一歩前進したことは確か。Rubyがんばるぜ。</p>
			</div>
			
			<div id="sidebar">
			<h3>Search</h3>
      		<form method="get" id="sform" action="/search">

       		 <label for="q">Search:</label>
				<input type="text" id="q" value="" name="q" size="15" />
				</form>
				<h3>Categories</h3>
				<ul>
					<li><a class="selected" href="/" title="Home">Home</a></li>
				</ul>

				
				<h3>Latest Posts</h3>
			</div>
		
		</div>
		<div id="footer">
<p class="validate"><a href="http://validator.w3.org/check?uri=referer">XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/">CSS</a><br /><a href="#content">Top</a></p>		

<!-- Please leave this line intact -->
<p>Template design by <a href="http://www.sixshootermedia.com">Six Shooter Media</a>.<br />

Theme by <a href="http://www.stuartloxton.com">Stuart Loxton</a><br />

Driven with <a href="http://github.com/mojombo/jekyll" title="mojombo's jekyll at master - GitHub">jekyll</a>
<!-- you can delete below here --></p>
</div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1110156-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>