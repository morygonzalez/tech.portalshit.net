---
id: 26
title: Vimで編集を終了した後、元のコンソールの状態を復元したい
category: Unix
layout: post
---

FreeBSDでVimを起動しファイルを編集したあと、 `:q` でVimを終了させてるのに元のコンソールに戻らなくてなんか嫌だなーと思っていた。MacもUbuntuもDreamHostのDebianもVimを閉じると元に戻るのに、職場の本番環境のFreeBSDだけこれなの。ファイル編集前のコンソールの履歴とかを見たいこともあるので、Vimが終了したら元の画面に戻るようにしたいと随分長いこと思っていたんだけど、たったいまようやく出来たのでメモっときます。

ちなみにVimには `restorescreen` とかいうオプションがあるらしく、必死で.vimrcにこの設定を書いてたけど、これはなんかWindowsのVim専用のオプションらしいのでマカーやUNIXユーザーの方はこれを設定しても無駄です。

情報元は [フルスクリーンアプリを終了したときに元のコンソールの状態に復元する - 技術メモ帳](http://d.hatena.ne.jp/lurker/20061118/1163810847 "フルスクリーンアプリを終了したときに元のコンソールの状態に復元する - 技術メモ帳") というページ。

FreeBSDの場合、 `/etc/termcap` ってのの中にフルスクリーンアプリを終了したときにコンソールに戻るかどうかを設定する場所があって、こいつを変更すればよいらしい。

しかし自分はこのサーバーでroot権限を持ってない。なので `cp /etc/termcap ~/.termcap` したあと `chmod 644 ~/.termcap` して `vim ~/.termcap` し、自分の使ってるターミナルの環境に合わせて設定を変更してやるとOK。

僕の場合はMacの純正ターミナルを、シェルはzshで使っている。 `echo $TERM` してみると `xterm-color` と表示されるのでxterm-colorの設定が書いてあるところをいじった。

くわしくは上のリンク先を見てもらうといいんだけど、とにかく `te` ってのと `ti` ってのがあって、これをMacの場合は `te=\E7\E[?47h` 、 `ti=\E[2J\E[?47l\E` としてあげればいい。そんでシェルの設定ファイルに `export $TERMPATH=$HOME/.termcap` と書いてやり、一端ログアウトして再ログインするとめでたくVimを終了したときにコンソールが復元されるようになります。